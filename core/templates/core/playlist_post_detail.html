{% extends 'base.html' %}
{% load static %}
{% load cloudinary %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'core/css/core_styles.css' %}" />
{% endblock extra_head %}

{% block main_content %}


<div class="grid-post-detail grid container">

    <section class="playlist-description flex-column-left">
        <h1>Playlist Details:</h1>
        <h2>"{{ playlist_post.playlist.title }}" shared by &nbsp; &nbsp;
            <span>
                {% if author_profile.avatar.url %}
                <a href="#" aria-label="link to the author profile page" id="playlist-author-avatar">
                    {% cloudinary author_profile.avatar %}</a>
                {% endif %}
            </span>
            <span id="palylist-author-name">
                <a href="#" aria-label="link to the author profile page">{{ author_profile.user.username }}</a>
            </span>
        </h2>
    
        <article class="flex-column-left">
            {% if playlist_post.playlist.featured_image %}
            <div class="featured-image">
                {% cloudinary playlist_post.playlist.featured_image %}
            </div>
            {% else %}
            <p>No Featured image provided by Author</p>
            {% endif %}
            <div>
                <p>Description:</p>
                <div class="shadow-white padding-10">{{ playlist_post.playlist.description | safe }}</div>
            </div>
            {% if playlist_post.playlist.reference_url %}
            <a href="{{ playlist_post.playlist.reference_url }}" aria-label="url reference featuring playlist main message"
                target="_blank">ðŸ”— The Author has provided this link for your reference (opens in a new window)</a>
            {% endif %}
            <p>Created on: {{ playlist_post.created_on }}</p>
            <p>Total Likes: {{ playlist_post.total_likes }}</p>
            <p>Total Comments: {{ comment_count }}</p>
        </article>
    </section>
    <section class="playlist-items-container box-shadow back-dark padding-20">
        <h2>Songs or other Items in this Playlist:</h2>
        <ul class="flex-column">
            {% for item in playlist_items %}
            <li>{{ item }} Performance Type: {{ item.get_performance_type_display }}</li>
            <article class="playlist-item pop-down">
                <div>
                    <p>Artist/Author:</p>
                    <p>{{ item.artist }}</p>
                </div>
                <div>
                    {% if item.album %}
                    <p>Album:</p>
                    <p>{{ item.album }}</p>
                    {% endif %}
                </div>
                <div>
                    {% if item.song_url %}
                    <a href="{{ item.song_url }}" aria-label="link reference to the song" target="_blank">ðŸ”— Follow this
                        link provided by the Playlist's Author</a>
                    {% endif %}
                </div>
                <div>
                    {% if item.song_audio %}
                    <p>Song Audio:</p>
                    <a href="{{ item.song_audio.url }}" aria-label="link to the song audio file">ðŸ”— Follow this link to
                        download audio file</a>
                    {% endif %}
                </div>
                <div>
                    {% if item.song_tabs %}
                    <p>Song Docs (song tabs/notation or other useful stuff):</p>
                    <a href="{{ item.song_tabs.url }}" aria-label="link to the song docs file">ðŸ”— Follow this link</a>
                    {% endif %}
                </div>
                <div>
                    {% if item.performance_year %}
                    <p>Performed in:</p>
                    <p>{{ item.performance_year }}</p>
                    {% endif %}
                </div>
                <div>
                    <p>The song category:</p>
                    <p>{{ item.get_performance_type_display }}</p>
                </div>
                <div>
                    {% if item.song_comments %}
                    <p>The Playlist's Author comments on the song:</p>
                    <p>{{ item.song_comments | linebreaks }}</p>
                    {% endif %}
                </div>
            </article>
            {% endfor %}
        </ul>
    </section>
</div>

<div class="playlist-comment grid container">
    <div class="flex-column-left">
        {% for comment in comments %}
        <div>
            <p><strong>{{ comment.author }}</strong> made a comment {{ comment.created_on|timesince }} ago:</p>
            <div class="flex-start">
                <div class="comment-content shadow-white">{{ comment.content | linebreaks }}</div>
                {% if user.is_authenticated and comment.author == user %}
                <button class="btn-delete" data-comment_id="{{ comment.id }}">Delete</button>
                <button class="btn-edit" data-comment_id="{{ comment.id }}">Edit</button>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p>No comments yet. Be the first to comment!</p>
        {% endfor %}
    </div>

    {% if user.is_authenticated %}
    <div class="box-shadow back-dark padding-20">
        <h3>Add a Comment</h3>
        <form method="post">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <button type="submit">Submit</button>
        </form>
    </div>
    {% endif %}
</div>

{% endblock main_content %}